(function(){var i,k,g,j,l=[].slice;this.Ewok={VERSION:"0.4",exports:function(a){_.extend(this,a);return this},eventable:function(a){_.extend(a,Backbone.Events);a.fire=a.trigger;return this},loggable:function(a,b){if(b==null){b=""}_.extend(a,j(b));return this},deferLoggable:function(c,d){if(d==null){d=""}_.extend(c,{log:function(){var a,b;a=1<=arguments.length?l.call(arguments,0):[];b=this.constructor.name?"["+this.constructor.name+"]":d;Ewok.loggable(this,b);return this['log'].apply(this,a)}});return this},fetchTemplate:(function(b,c){if(b){return function(a){return blam.compile(k(a))}}else if(c){return function(a){return Hogan.compile(k(a))}}else{return function(a){return _.template(k(a))}}})(typeof blam!=="undefined"&&blam!==null,typeof Hogan!=="undefined"&&Hogan!==null)};g=window.console&&console.log?true:false;i=(function(){try{console.log.apply(console,["[Ewok] waking up..."]);return true}catch(ex){console.log("NOPE!",ex);return false}})();j=function(e){var h;h={};h.log=g?i?function(){var a;a=1<=arguments.length?l.call(arguments,0):[];a.unshift(e);return console.log.apply(console,a)}:function(){var a,b,c,d,f;b=1<=arguments.length?l.call(arguments,0):[];console.log(e);f=[];for(c=0,d=b.length;c<d;c++){a=b[c];f.push(console.log(a))}return f}:function(){};return h};k=function(a){if(_.isString(a)){if(a.charAt(0)==="#"){return $(a).text()}else{return a}}else if(_.isFunction(a)){return a}};Ewok.loggable(Ewok);Ewok.eventable(Ewok)}).call(this);(function(){var h,i,k,g=function(a,b){return function(){return a.apply(b,arguments)}},j=[].slice,l={}.hasOwnProperty;h=(function(){e.route=function(a,b){if(b==null){b={}}this.routeMap||(this.routeMap={});return this.routeMap[a]=b};e.use_view=function(b){return{enter:function(){var a;a=1<=arguments.length?j.call(arguments,0):[];return this.app.showView(b,{params:this.params})},leave:function(){var a;a=1<=arguments.length?j.call(arguments,0):[]}}};e.call_method=function(d){return{enter:function(){var a,b,c;b=2<=arguments.length?j.call(arguments,0,c=arguments.length-1):(c=0,[]),a=arguments[c++];return a[d](true,b)},leave:function(){var a,b,c;b=2<=arguments.length?j.call(arguments,0,c=arguments.length-1):(c=0,[]),a=arguments[c++];return a[d](false,b)}}};e.run=function(a){if(this.instance==null){this.instance=new this;return this.instance.run(a)}else{this.instance.log("Already running!");return this.instance}};function e(){this._willInitialize=g(this._willInitialize,this);this.el||(this.el='body');this.stateMap=this.constructor.stateMap||{};this.routeMap=this.constructor.routeMap||{};this._buildRouter()}e.prototype._buildRouter=function(){var a,b,c,d,f;this.router=new Backbone.Router();c=null;f=this.routeMap;for(b in f){if(!l.call(f,b))continue;a=f[b];if(b==='404'){this.log("Route -> #"+b,a);c=new i(this,'.*',a);this.routeMap[b]=c}else{this.log("Route -> #"+b,a);d=new i(this,b,a);this.router.route(b,null,this._routeChange(d));this.routeMap[b]=d}}if(c!==null){this.log("Route -> *",a);this.router.route('.*',null,this._routeChange(c))}return this};e.prototype._willInitialize=function(){if(_.isString(this.el)){this.el=$(this.el)}if(this.initialize){this.initialize()}this.fire('app:init',{app:this});if(Backbone.history){Backbone.history.start()}else{this.log("No routes defined! Not starting Backbone.history")}return this.fire('app:run')};e.prototype._routeChange=function(b){var c=this;return function(){var a;a=1<=arguments.length?j.call(arguments,0):[];if(c._currentRoute){c._currentRoute.doLeave(a)}c._currentRoute=b;return c._currentRoute.doEnter(a)}};e.prototype.visit=function(a,b){if(b==null){b=false}return this.router.navigate(a,{trigger:true,replace:b})};e.prototype.history=function(a,b){if(b==null){b=false}return this.router.navigate(a,{trigger:false,replace:b})};e.prototype.showView=function(a,b){if(b==null){b={}}a=_.isFunction(a)?(b.app=this,new a(b)):(a.app=this,a);a.render();if(this.activeView){this.activeView.close()}this.doViewChange(a);this.activeView=a;a.show();return this};e.prototype.doViewChange=function(a){this.el.html("");return this.el.append(a.el)};e.prototype.run=function(a){this.options=a!=null?a:{};if(this.options.el){this.el=this.options.el}if(!this.options.immediate){$(this._willInitialize)}else{this._willInitialize()}return this};return e})();k=/:\w+/g;i=(function(){function e(a,b,c){var d,f;this.app=a;this.path=b;if(_.isFunction(c)){c=c()||{}}for(d in c){if(!l.call(c,d))continue;f=c[d];this[d]=f}}e.prototype.enter=function(){};e.prototype.leave=function(){};e.prototype.doEnter=function(a){this.params=this.argsToHash(a);a.push(this.app);return this.enter.apply(this,a)};e.prototype.doLeave=function(a){a.push(this.app);this.leave.apply(this,a);return this.params={}};e.prototype.argsToHash=function(c){var d,f;d={};f=this.path.match(k);_.each(f,function(a,b){return d[a.slice(1)]=c[b]});return d};return e})();Ewok.deferLoggable(h.prototype,'[App]').eventable(h.prototype).exports({App:h})}).call(this);(function(){var h,i={}.hasOwnProperty,k=function(a,b){for(var c in b){if(i.call(b,c))a[c]=b[c]}function ctor(){this.constructor=a}ctor.prototype=b.prototype;a.prototype=new ctor();a.__super__=b.prototype;return a},g=[].slice;h=(function(f){k(e,f);function e(a){var b,c,d;if(this.templates){d=this.templates;for(b in d){if(!i.call(d,b))continue;c=d[b];this.templates[b]=this.fetchTemplate(c)}}e.__super__.constructor.call(this,a)}e.prototype._configure=function(a){e.__super__._configure.call(this,a);if(this.options.parent){this.parent=this.options.parent}if(this.options.params){this.params=this.options.params}if(this.options.app){this.app=this.options.app}if(!this.id){this.id=this.cid}if(!this.className){return this.className="ewok-view"}};e.prototype.setElement=function(a,b){e.__super__.setElement.call(this,a,b);this.$el.data('view',this);return this};e.prototype.attach=function(a,b){var c,d;this._attached||(this._attached=[]);for(d in b){if(!i.call(b,d))continue;c=b[d];if(!_.isFunction(c)){c=this[c]}a.on(d,c,this);this._attached.push({target:a,event:d,callback:c})}return this};e.prototype.detach=function(){var a,b,c,d;if(this._attached){d=this._attached;for(b=0,c=d.length;b<c;b++){a=d[b];a.target.off(a.event,a.callback,this)}}this._attached=[];return this};e.prototype.addView=function(a,b){if(b==null){b={}}this._views||(this._views=[]);if(_.isFunction(a)){a=new a(b)}a.parent=this;this._views.push(a);if(b.auto_render!==false){a.render()}return a};e.prototype.close=function(){this.unbind();this.detach();this.closeChildViews();this.$el.data('view',null);this.remove();if(this.onClose){this.onClose()}return this};e.prototype.closeChildViews=function(){var a,b,c,d;if(this._views){d=this._views;for(b=0,c=d.length;b<c;b++){a=d[b];a.close()}}return this};e.prototype.show=function(){if(this.onShow){this.onShow()}return this};e.prototype.render=function(){var a,b,c;b=1<=arguments.length?g.call(arguments,0):[];if(this.templates.main){a=this.model!=null?this.model.toJSON?this.model.toJSON():this.model:this.params?this.params:this.collection?this.collection.toJSON():{};this.$el.html((c=this.templates).main.apply(c,[a].concat(g.call(b))))}return this};e.prototype.fetchTemplate=function(a){if(_.isString(a)){return Ewok.fetchTemplate(a)}else{return blam.compile(a)}};return e})(Backbone.View);Ewok.deferLoggable(h.prototype).exports({View:h});$.fn.view=function(){var a,b;b=null;a=$(this);while(!b&&a.length>0){b=a.data('view');if(!b){a=a.parent()}}return b}}).call(this);(function(){var d,f={}.hasOwnProperty,e=function(a,b){for(var c in b){if(f.call(b,c))a[c]=b[c]}function ctor(){this.constructor=a}ctor.prototype=b.prototype;a.prototype=new ctor();a.__super__=b.prototype;return a};d=(function(a){e(b,a);function b(){return b.__super__.constructor.apply(this,arguments)}return b})(Backbone.Model);Ewok.deferLoggable(d.prototype).exports({Model:d})}).call(this);(function(){var j,l,m={}.hasOwnProperty,n=function(a,b){for(var c in b){if(m.call(b,c))a[c]=b[c]}function ctor(){this.constructor=a}ctor.prototype=b.prototype;a.prototype=new ctor();a.__super__=b.prototype;return a};j=(function(c){n(d,c);function d(){return d.__super__.constructor.apply(this,arguments)}d.prototype.liveFilter=function(a,b){return new l(this,a,b)};return d})(Backbone.Collection);l=(function(k){n(g,k);function g(a,b,c){var d,f,e,h,i;this._source=a;this._filter=b!=null?b:{};this.options=c!=null?c:{};if(!this._source){throw"Requires source collection!";}if(this.options.comparator||this._source.comparator){this.options.comparator=this.options.comparator||this._source.comparator}d=_.isFunction(this._filter)?'Fn':'Obj';i=['_runFilter','_bindFields','_unbindFields','_matchesFilter'];for(e=0,h=i.length;e<h;e++){f=i[e];this[f]=this[f+d]}g.__super__.constructor.call(this,this._runFilter(),this.options);this.start(false)}g.prototype.update=function(){return this.reset(this._runFilter())};g.prototype.stop=function(){this._source.off('add',this._didAddModel,this).off('remove',this._didRemoveModel,this).off('reset',this._didResetModels,this);this._unbindFields();return this};g.prototype.start=function(a){if(a==null){a=true}this._source.on('add',this._didAddModel,this).on('remove',this._didRemoveModel,this).on('reset',this._didResetModels,this);this._bindFields();if(a){this.update()}return this};g.prototype._didAddModel=function(a,b,c){if(this._matchesFilter(a)){return this.add(a,{at:c.index})}};g.prototype._didRemoveModel=function(a,b){return this.remove(a)};g.prototype._didResetModels=function(a){return this.update()};g.prototype._fieldDidChange=function(a){if(this._matchesFilter(a)){return this.add(a)}else{return this.remove(a)}};g.prototype._runFilterObj=function(){return this._source.where(this._filter)};g.prototype._bindFieldsObj=function(){var a,b,c;c=this._filter;for(a in c){if(!m.call(c,a))continue;b=c[a];this._source.on("change:"+a,this._fieldDidChange,this)}return this};g.prototype._unbindFieldsObj=function(){var a,b,c;c=this._filter;for(a in c){if(!m.call(c,a))continue;b=c[a];this._source.off("change:"+a,this._fieldDidChange,this)}return this};g.prototype._matchesFilterObj=function(a){var b,c,d;d=this._filter;for(b in d){if(!m.call(d,b))continue;c=d[b];if(c!==a.get(b)){return false}}return true};g.prototype._runFilterFn=function(){return this._source.filter(this._filter)};g.prototype._bindFieldsFn=function(){var a,b,c,d,f;if(_.isArray(this.options.fields)){d=this.options.fields;f=[];for(b=0,c=d.length;b<c;b++){a=d[b];f.push(this._source.on("change:"+a,this._fieldDidChange,this))}return f}else{return this._source.on("change",this._fieldDidChange,this)}};g.prototype._unbindFieldsFn=function(){var a,b,c,d,f;if(_.isArray(this.options.fields)){d=this.options.fields;f=[];for(b=0,c=d.length;b<c;b++){a=d[b];f.push(this._source.off("change:"+a,this._fieldDidChange,this))}return f}else{return this._source.off("change",this._fieldDidChange,this)}};g.prototype._matchesFilterFn=function(a){return this._filter(a)};return g})(Backbone.Collection);Ewok.deferLoggable(j.prototype,'[Collection]').deferLoggable(l.prototype,'[LiveCollection]').exports({Collection:j,LiveCollection:l})}).call(this);