(function(){var i,j,f,k,l=[].slice;f=window.console&&console.log?true:false;i=(function(){try{console.log.apply(console,["[Ewok] waking up..."]);return true}catch(ex){console.log("NOPE!",ex);return false}})();k=function(g){var h;h={};h.log=f?i?function(){var a;a=1<=arguments.length?l.call(arguments,0):[];a.unshift(g);return console.log.apply(console,a)}:function(){var a,b,c,d,e;b=1<=arguments.length?l.call(arguments,0):[];console.log(g);e=[];for(c=0,d=b.length;c<d;c++){a=b[c];e.push(console.log(a))}return e}:function(){};return h};j=function(a){if(_.isString(a)){if(a.charAt(0)==="#"){return $(a).text()}else{return a}}else if(_.isFunction(a)){return a}};this.Ewok={VERSION:"0.4",exports:function(a){_.extend(this,a);return this},eventable:function(a){_.extend(a,Backbone.Events);a.fire=a.trigger;return this},loggable:function(a,b){if(b==null){b=""}_.extend(a,k(b));return this},deferLoggable:function(c,d){if(d==null){d=""}_.extend(c,{log:function(){var a,b;a=1<=arguments.length?l.call(arguments,0):[];b=this.constructor.name?"["+this.constructor.name+"]":d;Ewok.loggable(this,b);return this['log'].apply(this,a)}});return this},fetchTemplate:(function(b,c){if(b){return function(a){return blam.compile(j(a))}}else if(c){return function(a){return Hogan.compile(j(a))}}else{return function(a){return _.template(j(a))}}})(typeof blam!=="undefined"&&blam!==null,typeof Hogan!=="undefined"&&Hogan!==null)};Ewok.loggable(Ewok);Ewok.eventable(Ewok)}).call(this);(function(){var h,i,j,f=function(a,b){return function(){return a.apply(b,arguments)}},k=[].slice,l={}.hasOwnProperty;h=(function(){e.route=function(a,b){if(b==null){b={}}this.routeMap||(this.routeMap={});return this.routeMap[a]=b};e.use_view=function(b){return{enter:function(){var a;a=1<=arguments.length?k.call(arguments,0):[];return this.app.showView(b,{params:this.params})},leave:function(){var a;a=1<=arguments.length?k.call(arguments,0):[]}}};e.call_method=function(d){return{enter:function(){var a,b,c;b=2<=arguments.length?k.call(arguments,0,c=arguments.length-1):(c=0,[]),a=arguments[c++];return a[d](true,b)},leave:function(){var a,b,c;b=2<=arguments.length?k.call(arguments,0,c=arguments.length-1):(c=0,[]),a=arguments[c++];return a[d](false,b)}}};e.run=function(a){if(this.instance==null){this.instance=new this;return this.instance.run(a)}else{this.instance.log("Already running!");return this.instance}};function e(){this._willInitialize=f(this._willInitialize,this);this.el||(this.el='body');this.stateMap=this.constructor.stateMap||{};this.routeMap=this.constructor.routeMap||{};this._buildRouter()}e.prototype._buildRouter=function(){var a,b,c,d;this.router=new Backbone.Router();d=this.routeMap;for(b in d){if(!l.call(d,b))continue;a=d[b];c=new i(this,b,a);this.router.route(b,null,this._routeChange(c));this.routeMap[b]=c}return this};e.prototype._willInitialize=function(){if(_.isString(this.el)){this.el=$(this.el)}if(this.initialize){this.initialize()}this.fire('app:init',{app:this});if(Backbone.history){Backbone.history.start()}else{this.log("No routes defined! Not starting Backbone.history")}return this.fire('app:run')};e.prototype._routeChange=function(b){var c=this;return function(){var a;a=1<=arguments.length?k.call(arguments,0):[];if(c._currentRoute){c._currentRoute.doLeave(a)}c._currentRoute=b;return c._currentRoute.doEnter(a)}};e.prototype.visit=function(a,b){if(b==null){b=false}return this.router.navigate(a,{trigger:true,replace:b})};e.prototype.history=function(a,b){if(b==null){b=false}return this.router.navigate(a,{trigger:false,replace:b})};e.prototype.showView=function(a,b){if(b==null){b={}}a=_.isFunction(a)?(b.app=this,new a(b)):(a.app=this,a);a.render();if(this.activeView){this.activeView.close()}this.doViewChange(a);this.activeView=a;a.show();return this};e.prototype.doViewChange=function(a){this.el.html("");return this.el.append(a.el)};e.prototype.run=function(a){this.options=a!=null?a:{};if(this.options.el){this.el=this.options.el}if(!this.options.immediate){$(this._willInitialize)}else{this._willInitialize()}return this};return e})();j=/:\w+/g;i=(function(){function g(a,b,c){var d,e;this.app=a;this.path=b;if(_.isFunction(c)){c=c()||{}}for(d in c){if(!l.call(c,d))continue;e=c[d];this[d]=e}}g.prototype.enter=function(){};g.prototype.leave=function(){};g.prototype.doEnter=function(a){this.params=this.argsToHash(a);a.push(this.app);return this.enter.apply(this,a)};g.prototype.doLeave=function(a){a.push(this.app);this.leave.apply(this,a);return this.params={}};g.prototype.argsToHash=function(c){var d,e;d={};e=this.path.match(j);_.each(e,function(a,b){return d[a.slice(1)]=c[b]});return d};return g})();Ewok.deferLoggable(h.prototype,'[App]').eventable(h.prototype).exports({App:h})}).call(this);(function(){var h,i={}.hasOwnProperty,j=function(a,b){for(var c in b){if(i.call(b,c))a[c]=b[c]}function ctor(){this.constructor=a}ctor.prototype=b.prototype;a.prototype=new ctor();a.__super__=b.prototype;return a};h=(function(e){j(g,e);function g(a){var b,c,d;if(this.templates){d=this.templates;for(b in d){if(!i.call(d,b))continue;c=d[b];this.templates[b]=this.fetchTemplate(c)}}g.__super__.constructor.call(this,a)}g.prototype._configure=function(a){g.__super__._configure.call(this,a);if(this.options.parent){this.parent=this.options.parent}if(this.options.params){this.params=this.options.params}if(this.options.app){this.app=this.options.app}if(!this.id){this.id=this.cid}if(!this.className){return this.className="ewok-view"}};g.prototype.setElement=function(a,b){g.__super__.setElement.call(this,a,b);this.$el.data('view',this);return this};g.prototype.attach=function(a,b){var c,d;this._attached||(this._attached=[]);for(d in b){if(!i.call(b,d))continue;c=b[d];if(!_.isFunction(c)){c=this[c]}a.on(d,c,this);this._attached.push({target:a,event:d,callback:c})}return this};g.prototype.detach=function(){var a,b,c,d;if(this._attached){d=this._attached;for(b=0,c=d.length;b<c;b++){a=d[b];a.target.off(a.event,a.callback,this)}}this._attached=[];return this};g.prototype.addView=function(a,b){if(b==null){b={}}this._views||(this._views=[]);if(_.isFunction(a)){a=new a(b)}a.parent=this;this._views.push(a);a.render(this);return a};g.prototype.close=function(){this.unbind();this.detach();this.closeChildViews();this.$el.data('view',null);this.remove();if(this.onClose){this.onClose()}return this};g.prototype.closeChildViews=function(){var a,b,c,d;if(this._views){d=this._views;for(b=0,c=d.length;b<c;b++){a=d[b];a.close()}}return this};g.prototype.show=function(){if(this.onShow){this.onShow()}return this};g.prototype.render=function(){var a;if(this.templates.main){a=this.model!=null?this.model.toJSON?this.model.toJSON():this.model:this.params?this.params:this.collection?this.collection.toJSON():{};this.$el.html(this.templates.main(a))}return this};g.prototype.fetchTemplate=function(a){if(_.isString(a)){return Ewok.fetchTemplate(a)}else{return blam.compile(a)}};return g})(Backbone.View);Ewok.deferLoggable(h.prototype).exports({View:h});$.fn.view=function(){var a,b;b=null;a=$(this);while(!b&&a.length>0){b=a.data('view');if(!b){a=a.parent()}}return b}}).call(this);(function(){var d,e={}.hasOwnProperty,g=function(a,b){for(var c in b){if(e.call(b,c))a[c]=b[c]}function ctor(){this.constructor=a}ctor.prototype=b.prototype;a.prototype=new ctor();a.__super__=b.prototype;return a};d=(function(a){g(b,a);function b(){return b.__super__.constructor.apply(this,arguments)}return b})(Backbone.Model);Ewok.deferLoggable(d.prototype).exports({Model:d})}).call(this);(function(){var k,l,m={}.hasOwnProperty,p=function(a,b){for(var c in b){if(m.call(b,c))a[c]=b[c]}function ctor(){this.constructor=a}ctor.prototype=b.prototype;a.prototype=new ctor();a.__super__=b.prototype;return a};k=(function(c){p(d,c);function d(){return d.__super__.constructor.apply(this,arguments)}d.prototype.liveFilter=function(a,b){return new l(this,a,b)};return d})(Backbone.Collection);l=(function(j){p(f,j);function f(a,b,c){var d,e,g,h,i;this._source=a;this._filter=b!=null?b:{};this.options=c!=null?c:{};if(!this._source){throw"Requires source collection!";}if(this.options.comparator||this._source.comparator){this.options.comparator=this.options.comparator||this._source.comparator}d=_.isFunction(this._filter)?'Fn':'Obj';i=['_runFilter','_bindFields','_unbindFields','_matchesFilter'];for(g=0,h=i.length;g<h;g++){e=i[g];this[e]=this[e+d]}f.__super__.constructor.call(this,this._runFilter(),this.options);this.start(false)}f.prototype.update=function(){return this.reset(this._runFilter())};f.prototype.stop=function(){this._source.off('add',this._didAddModel,this).off('remove',this._didRemoveModel,this).off('reset',this._didResetModels,this);this._unbindFields();return this};f.prototype.start=function(a){if(a==null){a=true}this._source.on('add',this._didAddModel,this).on('remove',this._didRemoveModel,this).on('reset',this._didResetModels,this);this._bindFields();if(a){this.update()}return this};f.prototype._didAddModel=function(a,b,c){if(this._matchesFilter(a)){return this.add(a,{at:c.index})}};f.prototype._didRemoveModel=function(a,b){return this.remove(a)};f.prototype._didResetModels=function(a){return this.update()};f.prototype._fieldDidChange=function(a){if(this._matchesFilter(a)){return this.add(a)}else{return this.remove(a)}};f.prototype._runFilterObj=function(){return this._source.where(this._filter)};f.prototype._bindFieldsObj=function(){var a,b,c;c=this._filter;for(a in c){if(!m.call(c,a))continue;b=c[a];this._source.on("change:"+a,this._fieldDidChange,this)}return this};f.prototype._unbindFieldsObj=function(){var a,b,c;c=this._filter;for(a in c){if(!m.call(c,a))continue;b=c[a];this._source.off("change:"+a,this._fieldDidChange,this)}return this};f.prototype._matchesFilterObj=function(a){var b,c,d;d=this._filter;for(b in d){if(!m.call(d,b))continue;c=d[b];if(c!==a.get(b)){return false}}return true};f.prototype._runFilterFn=function(){return this._source.filter(this._filter)};f.prototype._bindFieldsFn=function(){var a,b,c,d,e;if(_.isArray(this.options.fields)){d=this.options.fields;e=[];for(b=0,c=d.length;b<c;b++){a=d[b];e.push(this._source.on("change:"+a,this._fieldDidChange,this))}return e}else{return this._source.on("change",this._fieldDidChange,this)}};f.prototype._unbindFieldsFn=function(){var a,b,c,d,e;if(_.isArray(this.options.fields)){d=this.options.fields;e=[];for(b=0,c=d.length;b<c;b++){a=d[b];e.push(this._source.off("change:"+a,this._fieldDidChange,this))}return e}else{return this._source.off("change",this._fieldDidChange,this)}};f.prototype._matchesFilterFn=function(a){return this._filter(a)};return f})(Backbone.Collection);Ewok.deferLoggable(k.prototype,'[Collection]').deferLoggable(l.prototype,'[LiveCollection]').exports({Collection:k,LiveCollection:l})}).call(this);(function(){var k,l,m,p,n,q,r=function(a,b){return function(){return a.apply(b,arguments)}},o={}.hasOwnProperty;p=function(a,b){switch(b.type){case'radio':return a.find("[name="+b.name+"]:checked").val();case'checkbox':return $(b).is(':checked');default:return $(b).val()}};q=function(a,b,c){var d,e;e=a.find("[name="+b+"]").get(0);if(e){switch(e.type){case'radio':a.find("[name="+b+"][value="+c+"]").attr('checked',true);a.find("[name="+b+"][value!="+c+"]").attr('checked',false);a.find("[name="+b+"][value="+c+"]").prop('checked',true);a.find("[name="+b+"][value!="+c+"]").prop('checked',false);return n(a.find("[name="+b+"]"));case'checkbox':d=c===true||c==='on'||c==='true'||c==='1'||c>0||c===e.value;$(e).attr('checked',d);return n($(e));default:$(e).val(c);return n($(e))}}};n=function(a){if($.mobile){try{if(a.is(":checkbox,:radio")){return a.checkboxradio('refresh')}else if(a.is("select")){return a.selectmenu('refresh')}else if(a.is("input[type='range']")){return a.slider("refresh")}else if(a.is('input')){return a.textinput('refresh')}}catch(_error){}}};k=(function(){function c(a,b){this.name=a;this.elem=b;this.displayName=_.humanize(this.elem.attr('placeholder')||this.elem.data('display-name')||this.elem.parents('form').find("label[for="+(this.elem.attr('id'))+"]").text()||this.name);this.messages=[]}c.prototype.addMessage=function(a){this.messages.push(a);return this};c.prototype.toString=function(){return""+this.displayName+" "+(this.messages.join(' and '))+"."};return c})();l=(function(){function e(){this.reset()}e.prototype.reset=function(){this.errors={};this.length=0;this.first=null;return this};e.prototype.addError=function(a,b,c){var d;(d=this.errors)[a]||(d[a]=new k(a,b));this.errors[a].addMessage(c);this.length=_.keys(this.errors).length;if(!this.first){this.first=b}return this};e.prototype.focusFirstError=function(){var a;if(this.first){return(a=this.first.get(0))!=null?a.focus():void 0}};e.prototype.isEmpty=function(){return _.isEmpty(this.errors)};e.prototype.each=function(a){return _.each(this.errors,a)};e.prototype.map=function(a){return _.map(this.errors,a)};e.prototype.toString=function(){return""+(this.map(function(a){return a.toString()}).join(' '))};return e})();m=(function(){function f(b,c){var d=this;this.el=b;this.gather=r(this.gather,this);this.model=new Backbone.Model;this.errors=new l;this.gather();this.originalProps=this.model.toJSON();this._validationRules={};this.onSubmitCallback=function(){};this.el.bind('input',function(a){return d.gatherOne(a.target)});this.el.bind('change',function(a){return d.gatherOne(a.target)});this.el.bind('submit',function(a){d.gather();return d.onSubmitCallback(a)});if(this.validations){this.setValidations(this.validations)}if(c){this.setValidations(c)}}f.prototype.setValidations=function(a,b){var c,d,e,g,h,i,j;if(b==null){b=false}if(b){this._validationRules={}}for(c in a){if(!o.call(a,c))continue;e=a[c];(g=this._validationRules)[c]||(g[c]=[]);j=e.split(',');for(h=0,i=j.length;h<i;h++){d=j[h];this._validationRules[c].push(_.trim(d))}}return this};f.prototype.validate=function(){var a,b,c,d,e,g,h;this.errors.reset();h=this._validationRules;for(b in h){if(!o.call(h,b))continue;d=h[b];a=null;for(e=0,g=d.length;e<g;e++){c=d[e];if(f.Validator.test(c,this.model.get(b))===false){this.errors.addError(b,this.getElemForField(b),f.Validator.Description["for"](c))}}}return this};f.prototype.isValid=function(){this.validate();return this.hasErrors()};f.prototype.hasErrors=function(){return this.errors.isEmpty()};f.prototype.getElemForField=function(a){var b,c;b=this.el.find(":input[name="+a+"]");if(((c=b.get(0))!=null?c.type:void 0)==='radio'){return this.el.find(":input[name="+a+"][value="+(this.get(a))+"]")}else{return b}};f.prototype.numChanges=function(a){var b,c,d,e;if(a==null){a=false}if(a){this.gather()}c=0;e=this.originalProps;for(b in e){if(!o.call(e,b))continue;d=e[b];if((this.model.get(b)||"").toString()!==(d||"").toString()){c+=1}}return c};f.prototype.isDirty=function(){var a;a=this.numChanges(true);return a!==0};f.prototype.changedFields=function(){var a,b,c,d;this.gather();b=[];d=this.originalProps;for(a in d){if(!o.call(d,a))continue;c=d[a];if((this.model.get(a)||"").toString()!==(c||"").toString()){b.push(a)}}return b};f.prototype.populate=function(a,b){var c;if(b==null){b=true}c=a.toJSON?a.toJSON():a;if(b){this.originalProps=_.clone(c)}this.set(_.clone(c));return this};f.prototype.markAsClean=function(){this.gather();this.originalProps=this.toJSON();return this};f.prototype.reset=function(a){var b;if(a==null){a={}}if((b=this.el.get(0))!=null){b.reset()}this.set(_.clone(a));return this};f.prototype.gather=function(){var c=this;this.el.find(':input').each(function(a,b){return c.gatherOne(b)});return this};f.prototype.gatherOne=function(a){var b;if(a.name){b=p(this.el,a);this.model.set(a.name,b)}return this};f.prototype.focus=function(a){var b;return(b=this.getElemForField(a).get(0))!=null?b.focus():void 0};f.prototype.enable=function(a,b){if(a==null){a=':input'}if(b==null){b=true}this.el.find(a).removeAttr('disabled');if(b){n(this.el.find(a))}return this};f.prototype.disable=function(a,b){if(a==null){a=':input'}if(b==null){b=true}this.el.find(a).attr('disabled',true);if(b){n(this.el.find(a))}return this};f.prototype.enableField=function(a){return this.enable("[name="+a+"]")};f.prototype.disableField=function(a){return this.disable("[name="+a+"]")};f.prototype.enableFields=function(){var a,b,c,d;b=_.uniq(_.flatten(arguments));for(c=0,d=b.length;c<d;c++){a=b[c];this.enableField(a)}return this};f.prototype.disableFields=function(){var a,b,c,d;b=_.flatten(arguments);for(c=0,d=b.length;c<d;c++){a=b[c];this.disableField(a)}return this};f.prototype.get=function(a){return this.model.get(a)};f.prototype.set=function(a){var b,c;this.internal_events=true;for(b in a){if(!o.call(a,b))continue;c=a[b];q(this.el,b,c)}this.model.set(a);this.internal_events=false;return this};f.prototype.getAsNumber=function(a){return Number(this.get(a))};f.prototype.getAsInt=function(a){return parseInt(this.get(a))};f.prototype.getAsFloat=function(a){return parseFloat(this.get(a))};f.prototype.bind=function(a,b){if(a.toLowerCase()==='submit'){this.onSubmitCallback=b}else{this.model.bind(a,b)}return this};f.prototype.on=function(a,b){return this.bind(a,b)};f.prototype.refreshStyles=function(){this.el.find(':input').each(function(){});return n($(this))};f.prototype.toJSON=function(a){var b,c,d,e;if(a==null){a=[]}b={};e=this.model.attributes;for(c in e){if(!o.call(e,c))continue;d=e[c];if(!_.include(a,c)){b[c]=d}}return b};f.createFrom=function(a,b){return new f($(a),b)};f.create=function(a,b){return this.createFrom(a,b)};f.Validator={define:function(a,b,c){f.Validator[a]=c;f.Validator.Description[a]=b;return this},test:function(a,b){if(this[a]){return this[a](b)}else{if(typeof console!=="undefined"&&console!==null){console.log("Cannot find validator for "+a)}return false}},Description:{"for":function(a){return f.Validator.Description[a]||f.Validator.Description.unknown},unknown:"validation failed"}};return f})();m.Validator.define('required','is required',function(a){return a!==null&&a!==""&&!_.isUndefined(a)});if($){$.fn.formModel=function(a){var b;if(!(b=this.data('formModel'))){b=new m(this,a);this.data('formModel',b)}return b}}Ewok.exports({FormModel:m})}).call(this);