
(function(){var can_apply_log,getTemplateContent,has_console,logger,__slice=[].slice;has_console=window.console&&console.log?true:false;can_apply_log=(function(){try{console.log.apply(console,["[Ewok] waking up..."]);return true;}catch(ex){console.log("NOPE!",ex);return false;}})();logger=function(prefix){var con;con={};con.log=has_console?can_apply_log?function(){var args;args=1<=arguments.length?__slice.call(arguments,0):[];args.unshift(prefix);return console.log.apply(console,args);}:function(){var arg,args,_i,_len,_results;args=1<=arguments.length?__slice.call(arguments,0):[];console.log(prefix);_results=[];for(_i=0,_len=args.length;_i<_len;_i++){arg=args[_i];_results.push(console.log(arg));}
return _results;}:function(){};return con;};getTemplateContent=function(path){if(path.charAt(0)==="#"){return $(path).text();}else{return path;}};this.Ewok={VERSION:"0.1.1",exports:function(methods){_.extend(this,methods);return this;},eventable:function(obj){_.extend(obj,Backbone.Events);obj.fire=obj.trigger;return this;},loggable:function(obj,prefix){if(prefix==null){prefix="";}
_.extend(obj,logger(prefix));return this;},fetchTemplate:(function(has_hogan){if(has_hogan){return function(idOrTmpl){return Hogan.compile(getTemplateContent(idOrTmpl));};}else{return function(idOrTmpl){return _.template(getTemplateContent(idOrTmpl));};}})(typeof Hogan!=="undefined"&&Hogan!==null)};Ewok.loggable(Ewok);Ewok.eventable(Ewok);}).call(this);(function(){var App,RouteInfo,namedParamRE,__bind=function(fn,me){return function(){return fn.apply(me,arguments);};},__slice=[].slice,__hasProp={}.hasOwnProperty;App=(function(){App.route=function(path,fnOrHash){if(fnOrHash==null){fnOrHash={};}
this.routeMap||(this.routeMap={});return this.routeMap[path]=fnOrHash;};App.use_view=function(ViewClass){return{enter:function(){var args;args=1<=arguments.length?__slice.call(arguments,0):[];return this.app.showView(ViewClass,{params:this.params});},leave:function(){var args;args=1<=arguments.length?__slice.call(arguments,0):[];}};};App.call_method=function(fnName){return{enter:function(){var app,args,_i;args=2<=arguments.length?__slice.call(arguments,0,_i=arguments.length-1):(_i=0,[]),app=arguments[_i++];return app[fnName](true,args);},leave:function(){var app,args,_i;args=2<=arguments.length?__slice.call(arguments,0,_i=arguments.length-1):(_i=0,[]),app=arguments[_i++];return app[fnName](false,args);}};};App.run=function(opts){if(this.instance==null){this.instance=new this;return this.instance.run(opts);}else{this.instance.log("Already running!");return this.instance;}};function App(){this._willInitialize=__bind(this._willInitialize,this);var logPrefix;this.el||(this.el='body');logPrefix=this.constructor.name?"["+this.constructor.name+"]":'[App]';Ewok.loggable(this,logPrefix);this.stateMap=this.constructor.stateMap||{};this.routeMap=this.constructor.routeMap||{};this._buildRouter();}
App.prototype._buildRouter=function(){var info,path,rInfo,_ref;this.router=new Backbone.Router();_ref=this.routeMap;for(path in _ref){if(!__hasProp.call(_ref,path))continue;info=_ref[path];rInfo=new RouteInfo(this,path,info);this.router.route(path,null,this._routeChange(rInfo));this.routeMap[path]=rInfo;}
return this;};App.prototype._willInitialize=function(){if(_.isString(this.el)){this.el=$(this.el);}
if(this.initialize){this.initialize();}
this.fire('app:init',{app:this});if(Backbone.history){Backbone.history.start();}else{this.log("No routes defined! Not starting Backbone.history");}
return this.fire('app:run');};App.prototype._routeChange=function(info){var _this=this;return function(){var args;args=1<=arguments.length?__slice.call(arguments,0):[];if(_this._currentRoute){_this._currentRoute.doLeave(args);}
_this._currentRoute=info;return _this._currentRoute.doEnter(args);};};App.prototype.visit=function(path,silent){if(silent==null){silent=false;}
return this.router.navigate(path,{trigger:true,replace:silent});};App.prototype.history=function(path,silent){if(silent==null){silent=false;}
return this.router.navigate(path,{trigger:false,replace:silent});};App.prototype.showView=function(view,options){if(options==null){options={};}
view=_.isFunction(view)?(options.app=this,new view(options)):(view.app=this,view);view.render();if(this.activeView){this.activeView.close();}
this.el.html("");this.el.append(view.el);this.activeView=view;view.show();return this;};App.prototype.run=function(options){this.options=options!=null?options:{};if(this.options.el){this.el=this.options.el;}
if(!this.options.immediate){$(this._willInitialize);}else{this._willInitialize();}
return this;};return App;})();namedParamRE=/:\w+/g;RouteInfo=(function(){function RouteInfo(app,path,extra){var key,val;this.app=app;this.path=path;if(_.isFunction(extra)){extra=extra()||{};}
for(key in extra){if(!__hasProp.call(extra,key))continue;val=extra[key];this[key]=val;}}
RouteInfo.prototype.enter=function(){};RouteInfo.prototype.leave=function(){};RouteInfo.prototype.doEnter=function(args){this.params=this.argsToHash(args);args.push(this.app);return this.enter.apply(this,args);};RouteInfo.prototype.doLeave=function(args){args.push(this.app);this.leave.apply(this,args);return this.params={};};RouteInfo.prototype.argsToHash=function(args){var data,names;data={};names=this.path.match(namedParamRE);_.each(names,function(name,idx){return data[name.slice(1)]=args[idx];});return data;};return RouteInfo;})();Ewok.eventable(App.prototype).exports({App:App});}).call(this);(function(){var Template,attrRE,helpers,operators,parseAttrs,tagName,tag_builder,tags,_i,_len,_ref,__slice=[].slice;Template=(function(){Template.compile=function(source){var template;template=new this(source);return template.compile();};function Template(source){this.source=source;}
Template.prototype.parse=function(){var balanced,code;try{balanced=0;this.src=$.trim(this.source);code=['list'];while(this.src.length){code=code.concat(this.parser());}
if(balanced>0){throw"The expression is not balanced. Add "+balanced+" parentheses.";}else if(balanced<0){throw"The expression is not balanced. Remove "+(Math.abs(balanced))+" parentheses.";}
this.env||(this.env={});return this["eval"]().pop();}catch(ex){return this.log("Error: "+ex);}};Template.prototype.parser=function(){};Template.prototype["eval"]=function(){};Template.prototype.compile=function(){return this;};Template.prototype.render=function(data,helpers){if(helpers==null){helpers={};}
return"";};return Template;})();Ewok.loggable(Template.prototype,"[Template]").exports({Template:Template});helpers={print:function(){var s,str,_i,_len;s="";for(_i=0,_len=arguments.length;_i<_len;_i++){str=arguments[_i];s+=str;}
Ewok.log(s);return"";}};operators={first:function(){var l;l=arguments[0];if(!l||!l.length){return null;}
return l[0];},rest:function(){var l;l=arguments[0];if(!l||!l.length){return[];}
return l.slice(1);},cons:function(){var a;a=arguments[1];if(!a){return[arguments[0]];}
a.unshift(arguments[0]);return a;},not:function(){return!arguments[0];},and:function(){var arg,_i,_len;for(_i=0,_len=arguments.length;_i<_len;_i++){arg=arguments[_i];if(!arg){return false;}}
return true;},or:function(){var arg,_i,_len;for(_i=0,_len=arguments.length;_i<_len;_i++){arg=arguments[_i];if(arg){return true;}}
return false;},"<=":function(x,y){return x<=y;},"<":function(x,y){return x<y;},">=":function(x,y){return x>=y;},">":function(x,y){return x>y;},"=":function(x,y){return x===y;},"eq":function(x,y){return x===y;},"neq":function(x,y){return x!==y;},"+":function(){var res;res=isNaN(arguments[0])?"":0;$.each(arguments,function(i,x){return res+=x;});return res;},"-":function(){var res;res=arguments[0]*2;$.each(arguments,function(i,x){return res-=x;});return res;},"*":function(){var res;res=1;$.each(arguments,function(i,x){return res*=x;});return res;},"/":function(){var res;res=arguments[0]*arguments[0];$.each(arguments,function(i,x){return res/=x;});return res;}};operators.car=operators.first;operators.cdr=operators.rest;attrRE=/([\w]*)="([\w ]*)"/;parseAttrs=function(val){var full,key,value,_ref;if(typeof val==='string'&&attrRE.test(val)){_ref=val.match(attrRE),full=_ref[0],key=_ref[1],value=_ref[2];return" "+key+"=\""+value+"\"";}else{return false;}};tag_builder=function(expr,evaluate){var attr,attrs,body,exp,parts,tag,_i,_len,_ref;body="";attrs="";tag=expr[0];if((parts=tag.split('.')).length>1){tag=parts.shift();attrs+=" class=\""+(parts.join(' '))+"\"";}
_ref=expr.slice(1);for(_i=0,_len=_ref.length;_i<_len;_i++){exp=_ref[_i];if(attr=parseAttrs(exp)){attrs+=attr;}else{body+=evaluate(exp);}}
return"<"+tag+attrs+">"+body+"</"+tag+">";};tags={};_ref="a abbr address area article aside audio b base bdi bdo blockquote body br button canvas caption cite code col colgroup command data datalist dd del details dfn div dl dt em embed eventsource fieldset figcaption figure footer form h1 h2 h3 h4 h5 h6 head header hgroup hr html i iframe img input ins kbd keygen label legend li link mark map menu meta meter nav noscript object ol optgroup option output p param pre progress q ruby rp rt s samp script section select small source span strong style sub summary sup table tbody td textarea tfoot th thead time title tr track u ul var video wbr".split(' ');for(_i=0,_len=_ref.length;_i<_len;_i++){tagName=_ref[_i];tags[tagName]=tag_builder;}
Ewok.sexp=function(src,extras){var apply_to,code,evaluate,get_env,make_proc,method_missing,parser,render,scanner,_balanced,_env,_text;if(extras==null){extras={};}
_text=$.trim(src);_balanced=0;_env={};method_missing=function(expr){throw""+expr+" is not defined.";};if(extras.method_missing){method_missing=extras.method_missing;}
scanner=function(){var delta,fc,index,start,t;if(_text.length===0){return"";}
start=0;index=1;delta=0;fc=_text.charAt(0);if(fc==='('||fc===')'){index=1;_balanced+=fc==='('?1:-1;}else if(fc==='"'){index=_text.search(/[^\\]"/)+1;delta=1;}else{index=_text.search(/[ \n)]/);}
if(index<1){index=_text.length;}
t=_text.substring(start,index);_text=$.trim(_text.substring(index+delta));return t;};parser=function(){var expr,result,token;result=[];token=scanner();while(token!==')'&&token!==""){expr=token==='('?parser():token;result.push(expr);token=scanner();}
return result;};get_env=function(expr,env){var obj,part,parts,_j,_len1;if(typeof expr!=="string"){return false;}
if(expr in env){return env[expr];}
if((parts=expr.split('.')).length>1){if(parts[0]in env){obj=env;for(_j=0,_len1=parts.length;_j<_len1;_j++){part=parts[_j];obj=obj[part];}
if(obj!==env){return obj;}}}
if('_parent'in env){return get_env(expr,env['_parent']);}
return false;};apply_to=function(proc,args){if($.isFunction(proc)){return proc.apply(this,args);}
throw"Procedure "+proc+" is not defined";};make_proc=function(args,body,env){return function(){var newenv,params;params=1<=arguments.length?__slice.call(arguments,0):[];newenv={};newenv['_parent']=env;$.each(args,function(i,x){return newenv[x]=params[i];});$.each(body.slice(0,body.length-1),function(i,x){return evaluate(x,newenv);});return evaluate(body[body.length-1],newenv);};};evaluate=function(expr,env){var cases,data,ev,ez,ge,newenv,parts,res,rule,source,v,variable,_j,_k,_len1,_len2,_ref1;ez=expr[0];if(!isNaN(expr)){return Number(expr);}
if(expr==="nil"||expr==="null"){return null;}
if(ez==='"'){v=expr.slice(1);return v.replace(/[\\]"/g,'"');}
if(ez==="list"){return $.map(expr.slice(1),function(x){v=evaluate(x,env);if($.isArray(v)){return Array(v);}
return v;});}
if(ez==='quote'){v=expr[1];if(v[0]==='"'){return v.slice(1).replace(/[\\]"/g,'"');}
return v;}
if((ge=get_env(expr,env))){return ge;}
if(ez==="set"||ez==="set!"||ez==="setq"){variable=env[expr[1]]=evaluate(expr[2],env);return variable;}
if(ez==='if'){if(evaluate(expr[1],env)){return evaluate(expr[2],env);}
if(expr.length<=3){return null;}
$.each(expr.slice(2,expr[expr.length-2]),function(i,x){return evaluate(x,env);});return evaluate(expr[expr.length-1],env);}
if(ez==='cond'){cases=expr.slice(1,expr.length);for(_j=0,_len1=cases.length;_j<_len1;_j++){rule=cases[_j];if(evaluate(rule[0],env)){return evaluate(rule[rule.length-1]);}}
return null;}
if(ez==='each'){source=expr[1][0];res=[];_ref1=evaluate(source,env);for(_k=0,_len2=_ref1.length;_k<_len2;_k++){data=_ref1[_k];newenv=data;newenv['_parent']=env;res.push(evaluate(expr[2],newenv));}
return res.join('');}
if(expr in operators){return operators[expr];}
if(ez in tags){ev=function(src){return evaluate(src,env);};return tags[ez](expr,ev);}else if(typeof ez==='string'&&(parts=ez.split('.')).length>1){if(parts[0]in tags){ev=function(src){return evaluate(src,env);};return tags[parts[0]](expr,ev);}}
if(expr in helpers){return helpers[expr];}
if(expr in extras){return extras[expr];}
if(ez==='lambda'){return make_proc(expr[1],expr.slice(2),env);}
if(ez==='defun'){return env[expr[1]]=make_proc(expr[2],expr.slice(3),env);}
if(ez==='js'){return eval(expr[1]);}
if($.isArray(expr)){return apply_to(evaluate(ez,env),$.map(expr.slice(1),function(x,i){v=evaluate(x,env);if($.isArray(v)){return Array(v);}else{return v;}}));}
return method_missing(expr);};try{code=['list'];while(_text.length){code=code.concat(parser());}
if(_balanced>0){throw"The expression is not balanced. Add "+_balanced+" parentheses.";}else if(_balanced<0){throw"The expression is not balanced. Remove "+(Math.abs(_balanced))+" parentheses.";}
render=function(env){if(env==null){env={};}
env._root=env;return evaluate(code,env).pop();};render.code=code;render.render=function(env){if(env==null){env={};}
try{return render(env);}catch(ex){return"Error: "+ex;}};return render;}catch(ex){return function(env){if(env==null){env={};}
return"Error: "+ex;};}};}).call(this);(function(){var View,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key];}function ctor(){this.constructor=child;}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child;},__slice=[].slice;View=(function(_super){__extends(View,_super);function View(options){var name,path,_ref;if(this.templates){_ref=this.templates;for(name in _ref){if(!__hasProp.call(_ref,name))continue;path=_ref[name];this.templates[name]=this.fetchTemplate(path);}}
View.__super__.constructor.call(this,options);}
View.prototype._configure=function(options){View.__super__._configure.call(this,options);if(this.options.parent){this.parent=this.options.parent;}
if(this.options.params){this.params=this.options.params;}
if(this.options.app){this.app=this.options.app;}
if(!this.id){this.id=this.cid;}
if(!this.className){return this.className="ewok-view";}};View.prototype.setElement=function(element,delegate){View.__super__.setElement.call(this,element,delegate);this.$el.data('view',this);return this;};View.prototype.attach=function(target,events){var callback,event;this._attached||(this._attached=[]);for(event in events){if(!__hasProp.call(events,event))continue;callback=events[event];target.on(event,callback);this._attached.push({target:target,event:event,callback:callback});}
return this;};View.prototype.detach=function(){var item,_i,_len,_ref;if(this._attached){_ref=this._attached;for(_i=0,_len=_ref.length;_i<_len;_i++){item=_ref[_i];item.target.off(item.event,item.callback);}}
this._attached=[];return this;};View.prototype.addView=function(view,atts){if(atts==null){atts={};}
this._views||(this._views=[]);if(_.isFunction(view)){view=new view(atts);}
view.parent=this;this._views.push(view);view.render(this);return view;};View.prototype.close=function(){var view,_i,_len,_ref;this.unbind();this.detach();if(this._views){_ref=this._views;for(_i=0,_len=_ref.length;_i<_len;_i++){view=_ref[_i];view.close();}}
this.$el.data('view',null);this.remove();if(this.onClose){this.onClose();}
return this;};View.prototype.log=function(){var args,logPrefix;args=1<=arguments.length?__slice.call(arguments,0):[];logPrefix=this.constructor.name?"["+this.constructor.name+"]":'[View]';Ewok.loggable(this,logPrefix);return this['log'].apply(this,args);};View.prototype.show=function(){if(this.onShow){this.onShow();}
return this;};View.prototype.render=function(){var data;if(this.templates.main){data=this.model!=null?this.model.toJSON?this.model.toJSON():this.model:this.params?this.params:this.collection?{items:this.collection.toJSON()}:{};return this.$el.html(this.templates.main.render(data));}};View.prototype.fetchTemplate=function(path){if(_.isString(path)){return Ewok.fetchTemplate(path);}else{return path;}};return View;})(Backbone.View);Ewok.exports({View:View});$.fn.view=function(){var parent,view;view=null;parent=$(this);while(!view&&parent.length>0){view=parent.data('view');if(!view){parent=parent.parent();}}
return view;};}).call(this);(function(){var Model,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key];}function ctor(){this.constructor=child;}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child;};Model=(function(_super){__extends(Model,_super);function Model(){return Model.__super__.constructor.apply(this,arguments);}
return Model;})(Backbone.Model);Ewok.exports({Model:Model});}).call(this);(function(){var Collection,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key];}function ctor(){this.constructor=child;}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child;};Collection=(function(_super){__extends(Collection,_super);function Collection(){return Collection.__super__.constructor.apply(this,arguments);}
return Collection;})(Backbone.Collection);Ewok.exports({Collection:Collection});}).call(this);;